NFTVtwo.sol 合約驗證（Etherscan Verify）完整流程筆記（Sepolia / Foundry）
================================================================

目標
----
把已部署到 Sepolia 的 NFTVtwo 合約「上傳原始碼到 Etherscan」，讓 Etherscan 能夠：
1) 顯示 Source Code（合約原始碼）
2) 顯示 Read Contract / Write Contract 介面（可直接查 tokenURI、ownerOf 等）
3) 讓別人可以透明地確認：鏈上的 bytecode = 你寫的程式碼編譯結果


A. 先確認合約程式（NFTVtwo.sol）
-----------------------------
你目前的 NFTVtwo.sol（重點）：

- ERC721 + Ownable
- baseTokenURI 直接寫死（指向 GitHub raw 的資料夾，結尾一定要有 /）
- constructor 部署時：
  - 設定 ERC721("NFTee","ITM")
  - 設定 owner = msg.sender
  - _mint(msg.sender, 1)（部署時直接鑄造 tokenId=1 給部署者）
- tokenURI(1) 回傳：
  baseTokenURI + "1" + ".json"

（因此你的 metadata 應該放在該資料夾底下，檔名要是 1.json）


B. 準備 metadata 與圖片（GitHub raw URL）
----------------------------------------
1) 在你的 repo 裡放 metadata JSON
   位置（你現在用的是）：
   Learn_Web_3/First-Year/First_NFT/Notes_/

2) JSON 檔名要對上 tokenId
   例如 tokenId = 1 → 檔名就是：
   1.json

3) JSON 內容至少要有：
   - name
   - description
   - image（圖片連結）

4) 圖片也可以放 GitHub
   例如：
   test_img.png

5) 取得 GitHub raw URL（很重要）
   方法：
   - 打開檔案頁
   - 右上角 ... → 選 Raw / Download / Copy permalink（其中 Raw 最直接）
   raw 連結格式通常像：
   https://raw.githubusercontent.com/<user>/<repo>/<branch-or-commit>/<path>/<file>

6) 你的 baseTokenURI（資料夾）用「資料夾 raw 路徑」：
   https://raw.githubusercontent.com/ycl-2004/YC_Web3_Learning-Journey/main/Learn_Web_3/First-Year/First_NFT/Notes_/
   （注意：結尾一定要有 /）

7) 你的 tokenURI(1) 會變成：
   https://raw.githubusercontent.com/ycl-2004/YC_Web3_Learning-Journey/main/Learn_Web_3/First-Year/First_NFT/Notes_/1.json


C. Etherscan API Key 設定（必要）
--------------------------------
你要用 Foundry 的 verify-contract，就需要 Etherscan API Key。

1) 到 Etherscan（Sepolia 也一樣用同個帳號/Key）
   - 註冊/登入 Etherscan
   - 到帳號設定（Account）
   - 找 API Keys
   - Create New API Key

2) 把 API Key 放進 foundry-app/.env
   例：
   ETHERSCAN_API_KEY=你的key
   SEPOLIA_RPC_URL=你的rpc
   PRIVATE_KEY=你的私鑰（不要上傳 GitHub）

3) 在 terminal 讀取 .env
   進到 foundry-app 資料夾後：
   source .env

4) 檢查有沒有成功讀到（可選）
   echo $ETHERSCAN_API_KEY
   如果空的 → 表示 .env 沒被正確載入，或變數名字拼錯


D. 編譯（確保編譯版本一致）
--------------------------
Etherscan 驗證需要「編譯設定」跟部署時完全一致：
- Solidity 版本（solc version）
- optimizer 開關與 runs
- constructor args（若有）

你最後的狀態是：
- forge 用 Solc 0.8.33 編譯（你 build --force 有顯示）
  Compiling ... with Solc 0.8.33

因此驗證時不需要硬指定 v0.8.24（不然會 mismatch）。

執行：
forge build --force -vvv


E. 部署（Sepolia）
-----------------
部署指令（你已成功做過）類似：

source .env
forge create \
  --rpc-url $SEPOLIA_RPC_URL \
  --private-key $PRIVATE_KEY \
  --broadcast \
  src/NFTVtwo.sol:NFTVtwo

部署後會得到：
- Deployer: 你的錢包地址
- Deployed to: 合約地址（很重要，驗證要用）
- Transaction hash: 部署交易 hash

（你這次要驗證的合約地址是你指定的那個：0x76CDB7D96A08E8F54dF2d4b59167Db214994e442）


F. 驗證合約（Foundry → Etherscan）
---------------------------------
核心指令（你成功送出驗證的版本）：

forge verify-contract \
  --chain sepolia \
  --etherscan-api-key "$ETHERSCAN_API_KEY" \
  0x76CDB7D96A08E8F54dF2d4b59167Db214994e442 \
  src/NFTVtwo.sol:NFTVtwo

成功回應會像你看到的：
- Response: OK
- GUID: （一串驗證任務 id）
- URL: 你的合約頁

注意事項（常見錯誤怎麼避免）：
1) ETHERSCAN_API_KEY 讀不到
   你之前遇到：
   .env:3: command not found: ETHERSCAN_API_KEY
   解法：
   - 確保 .env 內容是 KEY=VALUE（不要寫成 export 之外怪格式也行，但最穩是 KEY=VALUE）
   - 進 foundry-app 再 source .env
   - 用 echo $ETHERSCAN_API_KEY 檢查

2) Compiler version mismatch
   你之前指定了 --compiler-version v0.8.24 但實際是 solc 0.8.33
   解法：
   - 不要亂指定版本
   - 以 forge build 顯示的版本為準

3) 用 Etherscan 網頁「單檔驗證」會失敗（import 找不到）
   你遇到的錯誤：
   "File import callback not supported"
   原因：
   - 你有 import OpenZeppelin，單檔模式沒辦法自動抓依賴
   解法：
   - 用 Foundry 的 verify-contract（會把依賴一起處理）
   - 或用 Etherscan 的 Standard JSON Input（比較麻煩）


G. 查驗證結果（verify-check）
-----------------------------
送出驗證後，用 GUID 查結果：

forge verify-check \
  --chain sepolia \
  --etherscan-api-key "$ETHERSCAN_API_KEY" \
  <你的GUID>

狀態可能是：
- Pending in queue（排隊中）
- Pass - Verified（成功）
- Fail（失敗，會有原因）


H. 在 Etherscan 上確認「真的成功」
---------------------------------
1) 打開合約頁（你貼的頁面就是正確位置）
   上方分頁：
   Transactions / Token Transfers / Contract / Events

2) 點 Contract → 會看到：
   - Code
   - Read Contract
   - Write Contract

3) 你現在看到 Read Contract / Write Contract 代表：
   ✅ 合約已 verified（至少已經有可讀介面）
   （若未 verified 通常只會看到 bytecode 或提示 Verify and Publish）

4) 進一步功能測試（最硬的成功證明）
   Contract → Read Contract
   - 找 tokenURI
   - tokenId 輸入 1
   - 應該回傳：
     https://raw.githubusercontent.com/ycl-2004/YC_Web3_Learning-Journey/main/Learn_Web_3/First-Year/First_NFT/Notes_/1.json

5) 打開回傳的 URL（瀏覽器）
   - 應該看到 JSON
   - JSON 裡的 image URL 也要能打開
   若都正常：
   ✅ metadata + image 路徑 OK
   ✅ 之後 OpenSea / 錢包顯示才有機會顯示圖片與描述（平台可能需要一點時間 refresh）


I. 最終結論（你這次做成功了什麼）
--------------------------------
你這次完成了 NFTVtwo 的「可讀 metadata NFT」＋「Etherscan 合約驗證」：

1) NFTVtwo 合約部署在 Sepolia 成功
2) 部署時 constructor 自動 mint tokenId=1 給部署者地址
3) tokenURI(1) 會指向 GitHub raw 的 1.json
4) 使用 Foundry 的 forge verify-contract 成功提交驗證（Etherscan 回 OK + GUID）
5) 在 Etherscan 合約頁面可看到 Contract → Read Contract / Write Contract
6) 後續用 Read Contract 的 tokenURI(1) + 打開 JSON/image，即可確認 metadata 顯示路徑是否完整
